const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-vendor-CimZ8x-k.js","assets/react-vendor-DvB2Xm2x.css"])))=>i.map(i=>d[i]);
import{bF as e,bE as t,r as s,bG as a,bD as r,bH as l,bJ as i,bK as c,bL as n,bi as o,bN as d,bO as m,bP as x,j as u,B as h,bQ as p,z as g,A as b,m as y,bR as f,a7 as j,an as w,bS as v,p as N,F as C}from"./react-vendor-CimZ8x-k.js";import{b as k,d as S,_ as E,a as T,L as _}from"./index-CE1QBjke.js";const I=new class{memoryCache=new Map;PREFIX="tasktide_cache_";CACHE_TIMES={STUDY_MATERIALS:3e5,USER_DATA:6e5,SETTINGS:9e5,TASKS:12e4,AI_RESPONSES:18e5};set(e,t,s){const a=s||this.CACHE_TIMES.STUDY_MATERIALS,r={data:t,timestamp:Date.now(),expiry:Date.now()+a};try{this.memoryCache.set(e,r),localStorage.setItem(this.PREFIX+e,JSON.stringify(r))}catch(l){console.warn("Cache storage failed:",l),this.memoryCache.set(e,r)}}get(e){try{let t=this.memoryCache.get(e);if(!t){const s=localStorage.getItem(this.PREFIX+e);s&&(t=JSON.parse(s),this.memoryCache.set(e,t))}return t&&Date.now()<t.expiry?t.data:(t&&this.delete(e),null)}catch(t){return console.warn("Cache retrieval failed:",t),null}}delete(e){this.memoryCache.delete(e);try{localStorage.removeItem(this.PREFIX+e)}catch(t){console.warn("Cache deletion failed:",t)}}clear(){this.memoryCache.clear();try{Object.keys(localStorage).forEach(e=>{e.startsWith(this.PREFIX)&&localStorage.removeItem(e)})}catch(e){console.warn("Cache clear failed:",e)}}clearExpired(){const e=Date.now();for(const[s,a]of this.memoryCache.entries())a.expiry<e&&this.memoryCache.delete(s);try{Object.keys(localStorage).forEach(t=>{if(t.startsWith(this.PREFIX))try{JSON.parse(localStorage.getItem(t)||"").expiry<e&&localStorage.removeItem(t)}catch(s){localStorage.removeItem(t)}})}catch(t){console.warn("Expired cache cleanup failed:",t)}}getStats(){const e=this.memoryCache.size;let t=0;try{t=Object.keys(localStorage).filter(e=>e.startsWith(this.PREFIX)).length}catch(s){console.warn("Cache stats failed:",s)}return{memorySize:e,localStorageSize:t,totalEntries:e+t}}async preloadUserData(e){[`user_${e}`,`tasks_${e}`,`settings_${e}`,`materials_${e}`].forEach(e=>{this.get(e)||this.set(`${e}_loading`,!0,3e4)})}isLoading(e){return!!this.get(`${e}_loading`)}setLoadingComplete(e){this.delete(`${e}_loading`)}};setInterval(()=>{I.clearExpired()},3e5);const A=(e,t=[],i=[],c=!1)=>{const{user:n}=k(),[o,d]=s.useState([]),[m,x]=s.useState(!0),[u,h]=s.useState(null),p=s.useRef(null),g=s.useRef(0),b=((e,t)=>{const[a,r]=s.useState(e);return s.useEffect(()=>{const s=setTimeout(()=>{r(e)},t);return()=>{clearTimeout(s)}},[e,t]),a})(i,300),y=`${e}_${n?.uid}_${JSON.stringify(t)}`,f=s.useCallback(async()=>{if(!n)return;const s=Date.now();if(!(s-g.current<1e3)){g.current=s;try{x(!0),h(null);const s=await(async(e,t,s)=>{const a=I.get(e);if(a)return a;if(I.isLoading(e))return new Promise(s=>{const a=setInterval(()=>{const r=I.get(e);!r&&I.isLoading(e)||(clearInterval(a),s(r||t()))},100)});try{const a=await t();return I.set(e,a,s),I.setLoadingComplete(e),a}catch(u){throw I.setLoadingComplete(e),u}})(y,async()=>{const s=a(S,e),l=r(s,...t),{getDocs:i}=await E(async()=>{const{getDocs:e}=await import("./react-vendor-CimZ8x-k.js").then(e=>e.bX);return{getDocs:e}},__vite__mapDeps([0,1]));return(await i(l)).docs.map(e=>({id:e.id,...e.data()}))},3e5);d(s)}catch(l){console.error(`Error fetching ${e}:`,l),h(l instanceof Error?l.message:"Failed to fetch data")}finally{x(!1)}}},[n,e,t,y]),j=s.useCallback(()=>{if(n&&c)try{const s=a(S,e),i=r(s,...t),c=l(i,e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));d(t),I.set(y,t),x(!1)},t=>{console.error(`Realtime listener error for ${e}:`,t),h(t.message),x(!1)});p.current=c}catch(s){console.error("Error setting up realtime listener:",s),h(s instanceof Error?s.message:"Failed to setup realtime updates")}},[n,e,t,y,c]);s.useEffect(()=>{if(!n)return d([]),void x(!1);const e=I.get(y);return e&&(d(e),x(!1)),c?j():f(),()=>{p.current&&(p.current(),p.current=null)}},[n,...b,c]);return{data:o,loading:m,error:u,refetch:s.useCallback(()=>{I.delete(y),f()},[y,f])}},L=()=>{const{user:r}=k(),{success:l,error:E}=T(),{data:L,loading:D,error:R,refetch:M}=((s=!1)=>{const{user:a}=k(),r=a?[e("userId","==",a.uid),t("createdAt","desc")]:[];return A("studyMaterials",r,[a?.uid],s)})(!0),[F,P]=s.useState(!1),[$,O]=s.useState(""),[z,U]=s.useState("all"),[X,J]=s.useState("all"),[H,W]=s.useState(!1),[B,K]=s.useState(!1),[Y,G]=s.useState({title:"",type:"pdf",url:"",subject:"",description:"",tags:[],newTag:""}),V=["Mathematics","Physics","Chemistry","Biology","Computer Science","History","English","Psychology","Economics","Art","Other"],q=[{value:"pdf",label:"PDF Document",icon:d},{value:"video",label:"Video",icon:x},{value:"link",label:"Web Link",icon:m},{value:"note",label:"Text Note",icon:d}];s.useEffect(()=>{R&&E(R)},[R,E]);const Q=s.useCallback(async()=>{if(r&&Y.title&&Y.url&&Y.subject){W(!0);try{const e={title:Y.title,type:Y.type,url:Y.url,subject:Y.subject,description:Y.description,tags:Y.tags,userId:r.uid,createdAt:i.now()};await c(a(S,"studyMaterials"),e),I.delete(`studyMaterials_${r.uid}_${JSON.stringify([])}`),M(),P(!1),ee(),l("Study material added successfully!")}catch(e){console.error("Error saving material:",e),E("Failed to save study material")}finally{W(!1)}}else E("Please fill in all required fields")},[r,Y,E,l,M]),Z=s.useCallback(async e=>{try{await n(o(S,"studyMaterials",e)),r&&I.delete(`studyMaterials_${r.uid}_${JSON.stringify([])}`),M(),l("Material deleted successfully")}catch(t){console.error("Error deleting material:",t),E("Failed to delete material")}},[r,M,l,E]),ee=s.useCallback(()=>{G({title:"",type:"pdf",url:"",subject:"",description:"",tags:[],newTag:""})},[]),te=s.useCallback(()=>{Y.newTag.trim()&&!Y.tags.includes(Y.newTag.trim())&&G(e=>({...e,tags:[...e.tags,e.newTag.trim()],newTag:""}))},[Y.newTag,Y.tags]),se=s.useCallback(e=>{G(t=>({...t,tags:t.tags.filter(t=>t!==e)}))},[]),ae=s.useMemo(()=>L.filter(e=>{const t=e.title.toLowerCase().includes($.toLowerCase())||e.description?.toLowerCase().includes($.toLowerCase())||e.tags.some(e=>e.toLowerCase().includes($.toLowerCase())),s="all"===z||e.subject===z,a="all"===X||e.type===X;return t&&s&&a}),[L,$,z,X]),re=s.useCallback(e=>({pdf:d,video:x,link:m,note:d}[e]||d),[]),le=s.useCallback(e=>{window.open(e.url,"_blank")},[]),ie=s.useCallback(async e=>{try{await navigator.clipboard.writeText(e),l("URL copied to clipboard")}catch(t){const s=document.createElement("textarea");s.value=e,document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s),l("URL copied to clipboard")}},[l]);return D?u.jsx("div",{className:"min-h-screen flex items-center justify-center",children:u.jsx(_,{size:"lg"})}):u.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-6",children:u.jsxs("div",{className:"max-w-7xl mx-auto",children:[u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between mb-6 sm:mb-8 gap-4",children:[u.jsxs("div",{children:[u.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-white mb-2",children:"Study Materials"}),u.jsx("p",{className:"text-gray-400",children:"Organize and access your study resources"})]}),u.jsxs("button",{onClick:()=>P(!0),className:"btn-primary flex items-center justify-center gap-2 w-full sm:w-auto",children:[u.jsx(h,{className:"w-5 h-5"}),"Add Material"]})]}),u.jsx("div",{className:"block lg:hidden mb-4",children:u.jsxs("button",{onClick:()=>K(!B),className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-black/20 border border-white/10 rounded-xl text-white hover:bg-black/30 transition-all",children:[u.jsx(p,{className:"w-5 h-5"}),B?"Hide Filters":"Show Filters"]})}),u.jsx("div",{className:"glass rounded-2xl p-4 sm:p-6 mb-6 sm:mb-8 "+(B?"":"hidden lg:block"),children:u.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[u.jsxs("div",{className:"relative flex-1",children:[u.jsx(g,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),u.jsx("input",{type:"text",placeholder:"Search materials...",value:$,onChange:e=>O(e.target.value),className:"w-full pl-10 pr-4 py-3 bg-black/20 border border-white/10 rounded-xl text-white placeholder-gray-400 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-all"})]}),u.jsxs("select",{value:z,onChange:e=>U(e.target.value),className:"px-4 py-3 bg-black/20 border border-white/10 rounded-xl text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-all",children:[u.jsx("option",{value:"all",children:"All Subjects"}),V.map(e=>u.jsx("option",{value:e,children:e},e))]}),u.jsxs("select",{value:X,onChange:e=>J(e.target.value),className:"px-4 py-3 bg-black/20 border border-white/10 rounded-xl text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-all",children:[u.jsx("option",{value:"all",children:"All Types"}),q.map(e=>u.jsx("option",{value:e.value,children:e.label},e.value))]})]})}),u.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:u.jsx(b,{children:ae.map(e=>{const t=re(e.type);return u.jsxs(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"glass rounded-2xl p-4 sm:p-6 hover:shadow-glow transition-all duration-300 group",children:[u.jsxs("div",{className:"flex items-start justify-between mb-4",children:[u.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[u.jsx("div",{className:"p-2 bg-primary-500/20 rounded-xl flex-shrink-0",children:u.jsx(t,{className:"w-5 h-5 sm:w-6 sm:h-6 text-primary-400"})}),u.jsxs("div",{className:"min-w-0 flex-1",children:[u.jsx("h3",{className:"text-white font-semibold text-sm sm:text-base line-clamp-1 break-words",children:e.title}),u.jsx("p",{className:"text-xs sm:text-sm text-gray-400",children:e.subject})]})]}),u.jsx("button",{onClick:()=>Z(e.id),className:"opacity-0 group-hover:opacity-100 p-2 text-red-400 hover:bg-red-500/20 rounded-lg transition-all flex-shrink-0",children:u.jsx(f,{className:"w-4 h-4"})})]}),e.description&&u.jsx("p",{className:"text-gray-300 text-xs sm:text-sm mb-4 line-clamp-2 break-words",children:e.description}),e.tags.length>0&&u.jsxs("div",{className:"flex flex-wrap gap-1 sm:gap-2 mb-4",children:[e.tags.slice(0,3).map(e=>u.jsx("span",{className:"px-2 py-1 bg-accent-500/20 text-accent-400 text-xs rounded-lg",children:e},e)),e.tags.length>3&&u.jsxs("span",{className:"px-2 py-1 bg-gray-500/20 text-gray-400 text-xs rounded-lg",children:["+",e.tags.length-3," more"]})]}),u.jsxs("div",{className:"flex items-center justify-between text-xs sm:text-sm text-gray-400 mb-4",children:[u.jsxs("div",{className:"flex items-center gap-1",children:[u.jsx(j,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.createdAt?.toDate?.()?.toLocaleDateString()||"Unknown date"]}),u.jsx("span",{className:"capitalize",children:e.type})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsxs("button",{onClick:()=>le(e),className:"flex-1 flex items-center justify-center gap-2 px-3 sm:px-4 py-2 bg-primary-500/20 text-primary-400 rounded-xl hover:bg-primary-500/30 transition-all text-xs sm:text-sm",children:[u.jsx(w,{className:"w-3 h-3 sm:w-4 sm:h-4"}),u.jsx("span",{className:"hidden sm:inline",children:"Open"})]}),u.jsx("button",{onClick:()=>ie(e.url),className:"px-3 sm:px-4 py-2 bg-white/5 text-gray-400 rounded-xl hover:bg-white/10 transition-all",title:"Copy URL",children:u.jsx(v,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]})]},e.id)})})}),0===ae.length&&u.jsxs("div",{className:"text-center py-12",children:[u.jsx(N,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),u.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No materials found"}),u.jsx("p",{className:"text-gray-400 mb-6",children:0===L.length?"Add your first study material to get started":"Try adjusting your search or filters"}),0===L.length&&u.jsx("button",{onClick:()=>P(!0),className:"btn-primary",children:"Add Your First Material"})]}),u.jsx(b,{children:F&&u.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:u.jsxs(y.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"glass rounded-3xl p-4 sm:p-8 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[u.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[u.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white",children:"Add Study Material"}),u.jsx("button",{onClick:()=>P(!1),className:"p-2 text-gray-400 hover:text-white transition-colors",children:u.jsx(C,{className:"w-6 h-6"})})]}),u.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Title *"}),u.jsx("input",{type:"text",value:Y.title,onChange:e=>G(t=>({...t,title:e.target.value})),className:"w-full px-4 py-3 bg-black/20 border border-white/10 rounded-xl text-white placeholder-gray-400 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-all text-sm sm:text-base",placeholder:"Enter material title"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Type *"}),u.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:q.map(e=>{const t=e.icon;return u.jsxs("button",{onClick:()=>G(t=>({...t,type:e.value})),className:"flex items-center gap-3 p-3 sm:p-4 rounded-xl border transition-all text-sm sm:text-base "+(Y.type===e.value?"border-primary-500 bg-primary-500/20 text-white":"border-white/10 text-gray-400 hover:border-white/20 hover:text-white"),children:[u.jsx(t,{className:"w-4 h-4 sm:w-5 sm:h-5"}),u.jsx("span",{className:"truncate",children:e.label})]},e.value)})})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"URL/Link *"}),u.jsx("input",{type:"url",value:Y.url,onChange:e=>G(t=>({...t,url:e.target.value})),className:"w-full px-4 py-3 bg-black/20 border border-white/10 rounded-xl text-white placeholder-gray-400 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-all text-sm sm:text-base",placeholder:"https://example.com/document.pdf"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Subject *"}),u.jsxs("select",{value:Y.subject,onChange:e=>G(t=>({...t,subject:e.target.value})),className:"w-full px-4 py-3 bg-black/20 border border-white/10 rounded-xl text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-all text-sm sm:text-base",children:[u.jsx("option",{value:"",children:"Select subject"}),V.map(e=>u.jsx("option",{value:e,children:e},e))]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Description"}),u.jsx("textarea",{value:Y.description,onChange:e=>G(t=>({...t,description:e.target.value})),className:"w-full px-4 py-3 bg-black/20 border border-white/10 rounded-xl text-white placeholder-gray-400 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-all resize-none text-sm sm:text-base",rows:3,placeholder:"Brief description of the material"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Tags"}),u.jsxs("div",{className:"flex gap-2 mb-3",children:[u.jsx("input",{type:"text",value:Y.newTag,onChange:e=>G(t=>({...t,newTag:e.target.value})),onKeyPress:e=>"Enter"===e.key&&(e.preventDefault(),te()),className:"flex-1 px-4 py-2 bg-black/20 border border-white/10 rounded-xl text-white placeholder-gray-400 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-all text-sm sm:text-base",placeholder:"Add a tag"}),u.jsx("button",{type:"button",onClick:te,className:"px-3 sm:px-4 py-2 bg-primary-500/20 text-primary-400 rounded-xl hover:bg-primary-500/30 transition-all text-sm sm:text-base whitespace-nowrap",children:"Add"})]}),Y.tags.length>0&&u.jsx("div",{className:"flex flex-wrap gap-2",children:Y.tags.map(e=>u.jsxs("span",{className:"flex items-center gap-2 px-3 py-1 bg-accent-500/20 text-accent-400 rounded-lg text-sm",children:[u.jsx("span",{className:"truncate max-w-[100px]",children:e}),u.jsx("button",{onClick:()=>se(e),className:"text-accent-400 hover:text-accent-300 flex-shrink-0",children:u.jsx(C,{className:"w-3 h-3"})})]},e))})]}),u.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[u.jsx("button",{onClick:()=>P(!1),className:"flex-1 px-6 py-3 border border-white/10 text-gray-400 rounded-xl hover:border-white/20 hover:text-white transition-all text-sm sm:text-base",children:"Cancel"}),u.jsx("button",{onClick:Q,disabled:H||!Y.title||!Y.url||!Y.subject,className:"flex-1 btn-primary disabled:opacity-50 disabled:cursor-not-allowed text-sm sm:text-base",children:H?"Saving...":"Save Material"})]})]})]})})})]})})};export{L as default};
